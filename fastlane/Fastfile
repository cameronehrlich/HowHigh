# frozen_string_literal: true

# Shared Fastlane configuration for the HowHigh project.
# This file defines lanes you can run locally or in CI.

def metadata_path
  File.expand_path("metadata", __dir__)
end

def screenshots_path
  File.expand_path("metadata/screenshots", __dir__)
end

def sanitize_output_directories
  FileUtils.mkdir_p(metadata_path)
  FileUtils.mkdir_p(screenshots_path)
end

fastlane_version '2.221.1'

default_platform(:ios)

platform :ios do
  desc "Download localized metadata and (optionally) screenshots from App Store Connect"
  lane :download_metadata do |options|
    sanitize_output_directories

    deliver(
      force: true,                          # overwrite local metadata files
      skip_binary_upload: true,             # we are not uploading a build
      skip_app_version_update: true,
      skip_metadata: false,
      skip_screenshots: options[:screenshots] ? false : true,
      overwrite_screenshots: options[:screenshots] ? true : false,
      metadata_path: metadata_path,
      screenshots_path: screenshots_path,
      redact_sensitive: false
    )
  end
end
